<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Primary SEO Meta Tags -->
    <title>Contract & Vendor Management Dashboard | TotalCareIT Partner Portal</title>
    <meta name="description" content="Contract lifecycle management and vendor tracking for MSP operations. Monitor insurance policies, software licenses, vendor agreements, renewal dates, and notice periods. Automated contract expiration alerts.">
    <meta name="keywords" content="contract management software, vendor management system, contract lifecycle management, insurance tracking, license management, renewal monitoring, MSP contract tracking, vendor compliance, contract expiration alerts">
    <link rel="canonical" href="https://totalcareit.ai/contract-monitor.html">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://totalcareit.ai/contract-monitor.html">
    <meta property="og:title" content="Contract & Vendor Management Dashboard | TotalCareIT Partner Portal">
    <meta property="og:description" content="Contract lifecycle management with automated renewal tracking, vendor monitoring, and expiration alerts for MSP operations.">
    <meta property="og:image" content="https://totalcareit.com/wp-content/uploads/2024/11/TotalCareIT-Registered-Logo-Full-Color.webp">

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://totalcareit.ai/contract-monitor.html">
    <meta name="twitter:title" content="Contract & Vendor Management Dashboard | TotalCareIT Partner Portal">
    <meta name="twitter:description" content="Contract lifecycle management with automated renewal tracking, vendor monitoring, and expiration alerts for MSP operations.">
    <meta name="twitter:image" content="https://totalcareit.com/wp-content/uploads/2024/11/TotalCareIT-Registered-Logo-Full-Color.webp">

    <!-- Structured Data for AI Search Engines -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "TotalCareIT Contract Monitor",
      "description": "Contract lifecycle and vendor management dashboard with automated renewal tracking and expiration alerts",
      "url": "https://totalcareit.ai/contract-monitor.html",
      "applicationCategory": "BusinessApplication",
      "operatingSystem": "Web",
      "provider": {
        "@type": "Organization",
        "name": "TotalCareIT",
        "url": "https://totalcareit.ai"
      },
      "featureList": [
        "Contract lifecycle tracking",
        "Vendor management",
        "Insurance policy monitoring",
        "Software license tracking",
        "Renewal date tracking",
        "Notice period alerts",
        "Auto-renewal monitoring",
        "Contract value tracking",
        "Expiration warnings",
        "Vendor compliance tracking"
      ]
    }
    </script>

    <link rel="stylesheet" href="css/styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <script src="https://alcdn.msauth.net/browser/2.30.0/js/msal-browser.min.js"></script>

    <style>
        .contract-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem;
            border-radius: 12px;
            margin-bottom: 2rem;
        }

        .contract-header h1 {
            margin: 0 0 0.5rem 0;
            font-size: 2rem;
            font-weight: 700;
        }

        .contract-header p {
            margin: 0;
            opacity: 0.95;
        }

        .filter-bar {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            margin-bottom: 2rem;
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            align-items: center;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            min-width: 200px;
        }

        .filter-group label {
            font-size: 0.875rem;
            font-weight: 600;
            color: #4a5568;
        }

        .filter-group select,
        .filter-group input {
            padding: 0.5rem;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            font-size: 0.875rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            border-left: 4px solid;
        }

        .stat-card.critical {
            border-left-color: #ef4444;
        }

        .stat-card.warning {
            border-left-color: #f59e0b;
        }

        .stat-card.success {
            border-left-color: #10b981;
        }

        .stat-card.info {
            border-left-color: #3b82f6;
        }

        .stat-card h3 {
            margin: 0 0 0.5rem 0;
            font-size: 0.875rem;
            font-weight: 600;
            color: #6b7280;
            text-transform: uppercase;
        }

        .stat-card .value {
            font-size: 2rem;
            font-weight: 700;
            color: #1f2937;
        }

        .contracts-table-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            overflow: hidden;
        }

        .contracts-table {
            width: 100%;
            border-collapse: collapse;
        }

        .contracts-table thead {
            background: #f8fafc;
        }

        .contracts-table th {
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            color: #4a5568;
            font-size: 0.875rem;
            border-bottom: 2px solid #e2e8f0;
        }

        .contracts-table td {
            padding: 1rem;
            border-bottom: 1px solid #f1f5f9;
            font-size: 0.875rem;
        }

        .contracts-table tbody tr:hover {
            background: #f8fafc;
        }

        .status-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-badge.critical {
            background: #fee2e2;
            color: #991b1b;
        }

        .status-badge.warning {
            background: #fef3c7;
            color: #92400e;
        }

        .status-badge.active {
            background: #d1fae5;
            color: #065f46;
        }

        .status-badge.upcoming {
            background: #dbeafe;
            color: #1e40af;
        }

        .action-buttons {
            display: flex;
            gap: 0.5rem;
        }

        .btn-action {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 6px;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-view {
            background: #eff6ff;
            color: #1e40af;
        }

        .btn-view:hover {
            background: #dbeafe;
        }

        .btn-edit {
            background: #f0fdf4;
            color: #166534;
        }

        .btn-edit:hover {
            background: #dcfce7;
        }

        .btn-add {
            background: #667eea;
            color: white;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            margin-left: auto;
        }

        .btn-add:hover {
            background: #5568d3;
        }

        .days-remaining {
            font-weight: 600;
        }

        .days-remaining.critical {
            color: #dc2626;
        }

        .days-remaining.warning {
            color: #ea580c;
        }

        .days-remaining.safe {
            color: #059669;
        }

        .contract-type-icon {
            display: inline-block;
            width: 32px;
            height: 32px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            margin-right: 0.5rem;
        }

        .type-insurance {
            background: #dbeafe;
            color: #1e40af;
        }

        .type-vendor {
            background: #fce7f3;
            color: #9f1239;
        }

        .type-service {
            background: #fef3c7;
            color: #92400e;
        }

        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: #6b7280;
        }

        .empty-state svg {
            width: 64px;
            height: 64px;
            margin-bottom: 1rem;
            opacity: 0.5;
        }
    </style>
</head>
<body class="dashboard-page">
    <div class="dashboard-container">
        <!-- Partner Portal Navigation (loaded from includes/partner-nav.html) -->
        <div id="partner-nav-placeholder"></div>
        <script src="js/load-nav.js"></script>

        <main class="dashboard-main">
            <div class="contract-header">
                <h1>ðŸ“‹ Contract Monitor</h1>
                <p>Track insurance and vendor contracts, renewal dates, and notice periods</p>
            </div>

            <!-- Statistics Cards -->
            <div class="stats-grid">
                <div class="stat-card critical">
                    <h3>Expiring Soon (30 days)</h3>
                    <div class="value" id="stat-expiring">0</div>
                </div>
                <div class="stat-card warning">
                    <h3>Notice Required (60 days)</h3>
                    <div class="value" id="stat-notice">0</div>
                </div>
                <div class="stat-card success">
                    <h3>Active Contracts</h3>
                    <div class="value" id="stat-active">0</div>
                </div>
                <div class="stat-card info">
                    <h3>Total Annual Value</h3>
                    <div class="value" id="stat-value">$0</div>
                </div>
            </div>

            <!-- Filter Bar -->
            <div class="filter-bar">
                <div class="filter-group">
                    <label for="filter-type">Contract Type</label>
                    <select id="filter-type">
                        <option value="all">All Types</option>
                        <option value="insurance">Insurance</option>
                        <option value="vendor">Vendor</option>
                        <option value="service">Service Provider</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="filter-status">Status</label>
                    <select id="filter-status">
                        <option value="all">All Status</option>
                        <option value="critical">Expiring Soon</option>
                        <option value="warning">Notice Required</option>
                        <option value="active">Active</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="filter-search">Search</label>
                    <input type="text" id="filter-search" placeholder="Search contracts...">
                </div>
                <button class="btn-add" onclick="alert('Add new contract feature coming soon!')">
                    + Add Contract
                </button>
            </div>

            <!-- Contracts Table -->
            <div class="contracts-table-container">
                <table class="contracts-table">
                    <thead>
                        <tr>
                            <th>Contract Name</th>
                            <th>Type</th>
                            <th>Vendor/Provider</th>
                            <th>Start Date</th>
                            <th>End Date</th>
                            <th>Notice Period</th>
                            <th>Notice Due Date</th>
                            <th>Days Remaining</th>
                            <th>Annual Value</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="contracts-tbody">
                        <!-- Contracts will be loaded here -->
                    </tbody>
                </table>
            </div>
        </main>
    </div>

    <script src="js/auth.js"></script>
    <script>
        let allContracts = [];

        // Load contract data
        async function loadContracts() {
            try {
                const response = await fetch('data/contracts.json');
                allContracts = await response.json();
                updateStatistics();
                renderContracts(allContracts);
            } catch (error) {
                console.error('Error loading contracts:', error);
                // Load sample data if file doesn't exist
                loadSampleData();
            }
        }

        function loadSampleData() {
            allContracts = [
                {
                    name: "General Liability Insurance",
                    type: "insurance",
                    vendor: "Hartford Insurance",
                    startDate: "2024-01-01",
                    endDate: "2025-01-01",
                    noticePeriod: 60,
                    annualValue: 15000,
                    autoRenew: true
                },
                {
                    name: "Professional Liability (E&O)",
                    type: "insurance",
                    vendor: "Travelers Insurance",
                    startDate: "2024-03-15",
                    endDate: "2025-03-15",
                    noticePeriod: 30,
                    annualValue: 8500,
                    autoRenew: false
                },
                {
                    name: "Microsoft CSP Agreement",
                    type: "vendor",
                    vendor: "Microsoft",
                    startDate: "2023-06-01",
                    endDate: "2025-06-01",
                    noticePeriod: 90,
                    annualValue: 125000,
                    autoRenew: true
                },
                {
                    name: "Autotask PSA",
                    type: "service",
                    vendor: "Datto/Kaseya",
                    startDate: "2024-01-01",
                    endDate: "2025-12-31",
                    noticePeriod: 60,
                    annualValue: 12000,
                    autoRenew: true
                },
                {
                    name: "Cybersecurity Insurance",
                    type: "insurance",
                    vendor: "Coalition Insurance",
                    startDate: "2024-11-01",
                    endDate: "2025-11-01",
                    noticePeriod: 30,
                    annualValue: 18000,
                    autoRenew: false
                },
                {
                    name: "IT Glue Documentation",
                    type: "service",
                    vendor: "Kaseya",
                    startDate: "2024-02-01",
                    endDate: "2025-02-01",
                    noticePeriod: 30,
                    annualValue: 4800,
                    autoRenew: true
                },
                {
                    name: "Workers Compensation",
                    type: "insurance",
                    vendor: "State Fund",
                    startDate: "2024-01-01",
                    endDate: "2025-01-01",
                    noticePeriod: 60,
                    annualValue: 22000,
                    autoRenew: true
                }
            ];
            updateStatistics();
            renderContracts(allContracts);
        }

        function calculateDaysRemaining(endDate) {
            const today = new Date();
            const end = new Date(endDate);
            const diffTime = end - today;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            return diffDays;
        }

        function getNoticeDueDate(endDate, noticePeriod) {
            const end = new Date(endDate);
            const noticeDate = new Date(end);
            noticeDate.setDate(noticeDate.getDate() - noticePeriod);
            return noticeDate;
        }

        function getStatus(daysRemaining, noticeDueDate) {
            const today = new Date();
            const notice = new Date(noticeDueDate);
            const daysToNotice = Math.ceil((notice - today) / (1000 * 60 * 60 * 24));

            if (daysRemaining <= 30) {
                return { badge: 'critical', label: 'Expiring Soon' };
            } else if (daysToNotice <= 0 && daysRemaining > 30) {
                return { badge: 'warning', label: 'Notice Due' };
            } else if (daysToNotice <= 30) {
                return { badge: 'warning', label: 'Notice Upcoming' };
            } else {
                return { badge: 'active', label: 'Active' };
            }
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
        }

        function formatCurrency(value) {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD',
                minimumFractionDigits: 0
            }).format(value);
        }

        function updateStatistics() {
            let expiring = 0, notice = 0, active = 0, totalValue = 0;

            allContracts.forEach(contract => {
                const daysRemaining = calculateDaysRemaining(contract.endDate);
                const noticeDueDate = getNoticeDueDate(contract.endDate, contract.noticePeriod);
                const daysToNotice = Math.ceil((noticeDueDate - new Date()) / (1000 * 60 * 60 * 24));

                if (daysRemaining <= 30) expiring++;
                if (daysToNotice <= 60 && daysToNotice > 0) notice++;
                if (daysRemaining > 0) active++;
                totalValue += contract.annualValue;
            });

            document.getElementById('stat-expiring').textContent = expiring;
            document.getElementById('stat-notice').textContent = notice;
            document.getElementById('stat-active').textContent = active;
            document.getElementById('stat-value').textContent = formatCurrency(totalValue);
        }

        function renderContracts(contracts) {
            const tbody = document.getElementById('contracts-tbody');

            if (contracts.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="11" style="text-align: center; padding: 3rem;">
                            <div class="empty-state">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                    <polyline points="14 2 14 8 20 8"/>
                                </svg>
                                <h3>No contracts found</h3>
                                <p>Try adjusting your filters or add a new contract</p>
                            </div>
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = contracts.map(contract => {
                const daysRemaining = calculateDaysRemaining(contract.endDate);
                const noticeDueDate = getNoticeDueDate(contract.endDate, contract.noticePeriod);
                const status = getStatus(daysRemaining, noticeDueDate);

                const daysClass = daysRemaining <= 30 ? 'critical' :
                                 daysRemaining <= 90 ? 'warning' : 'safe';

                const typeClass = `type-${contract.type}`;
                const typeIcon = contract.type === 'insurance' ? 'I' :
                                contract.type === 'vendor' ? 'V' : 'S';

                return `
                    <tr>
                        <td>
                            <div style="display: flex; align-items: center;">
                                <div class="contract-type-icon ${typeClass}">${typeIcon}</div>
                                <strong>${contract.name}</strong>
                            </div>
                        </td>
                        <td style="text-transform: capitalize;">${contract.type}</td>
                        <td>${contract.vendor}</td>
                        <td>${formatDate(contract.startDate)}</td>
                        <td>${formatDate(contract.endDate)}</td>
                        <td>${contract.noticePeriod} days</td>
                        <td>${formatDate(noticeDueDate)}</td>
                        <td><span class="days-remaining ${daysClass}">${daysRemaining} days</span></td>
                        <td>${formatCurrency(contract.annualValue)}</td>
                        <td><span class="status-badge ${status.badge}">${status.label}</span></td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn-action btn-view" onclick="viewContract('${contract.name}')">View</button>
                                <button class="btn-action btn-edit" onclick="editContract('${contract.name}')">Edit</button>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function applyFilters() {
            const typeFilter = document.getElementById('filter-type').value;
            const statusFilter = document.getElementById('filter-status').value;
            const searchFilter = document.getElementById('filter-search').value.toLowerCase();

            let filtered = allContracts.filter(contract => {
                // Type filter
                if (typeFilter !== 'all' && contract.type !== typeFilter) return false;

                // Status filter
                if (statusFilter !== 'all') {
                    const daysRemaining = calculateDaysRemaining(contract.endDate);
                    const noticeDueDate = getNoticeDueDate(contract.endDate, contract.noticePeriod);
                    const status = getStatus(daysRemaining, noticeDueDate);

                    if (statusFilter === 'critical' && status.badge !== 'critical') return false;
                    if (statusFilter === 'warning' && status.badge !== 'warning') return false;
                    if (statusFilter === 'active' && status.badge !== 'active') return false;
                }

                // Search filter
                if (searchFilter &&
                    !contract.name.toLowerCase().includes(searchFilter) &&
                    !contract.vendor.toLowerCase().includes(searchFilter)) {
                    return false;
                }

                return true;
            });

            renderContracts(filtered);
        }

        function viewContract(name) {
            alert(`View contract: ${name}\n\nFull contract details feature coming soon!`);
        }

        function editContract(name) {
            alert(`Edit contract: ${name}\n\nContract editing feature coming soon!`);
        }

        // Event listeners
        document.getElementById('filter-type').addEventListener('change', applyFilters);
        document.getElementById('filter-status').addEventListener('change', applyFilters);
        document.getElementById('filter-search').addEventListener('input', applyFilters);

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            loadContracts();
        });
    </script>
</body>
</html>
