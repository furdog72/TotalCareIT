<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Primary SEO Meta Tags -->
    <title>Business Performance Scorecard & KPI Tracking | TotalCareIT</title>
    <meta name="description" content="Real-time business KPI tracking and performance scorecard for MSP operations. Monitor sales activities, operations metrics, centralized services, and vCIO performance. Data-driven MSP management nationwide.">
    <meta name="keywords" content="MSP KPI tracking, business scorecard, performance metrics, sales KPIs, operations metrics, vCIO performance, MSP analytics, business intelligence, TruMethods scorecard, MSP benchmarking, service desk metrics">
    <link rel="canonical" href="https://totalcareit.ai/scorecard.html">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://totalcareit.ai/scorecard.html">
    <meta property="og:title" content="Business Performance Scorecard & KPI Tracking | TotalCareIT">
    <meta property="og:description" content="Real-time business KPI tracking and performance scorecard for MSP operations with quarterly analytics and goal monitoring.">
    <meta property="og:image" content="https://totalcareit.com/wp-content/uploads/2024/11/TotalCareIT-Registered-Logo-Full-Color.webp">

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://totalcareit.ai/scorecard.html">
    <meta name="twitter:title" content="Business Performance Scorecard & KPI Tracking | TotalCareIT">
    <meta name="twitter:description" content="Real-time business KPI tracking and performance scorecard for MSP operations with quarterly analytics and goal monitoring.">
    <meta name="twitter:image" content="https://totalcareit.com/wp-content/uploads/2024/11/TotalCareIT-Registered-Logo-Full-Color.webp">

    <!-- Structured Data for AI Search Engines -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "TotalCareIT Performance Scorecard",
      "description": "Business performance scorecard and KPI tracking dashboard for MSP operations including sales, service desk, and technical metrics",
      "url": "https://totalcareit.ai/scorecard.html",
      "applicationCategory": "BusinessApplication",
      "operatingSystem": "Web",
      "provider": {
        "@type": "Organization",
        "name": "TotalCareIT",
        "url": "https://totalcareit.ai"
      },
      "featureList": [
        "Inside sales activity tracking",
        "Outside sales KPI monitoring",
        "Warm 250 prospect tracking",
        "Reactive operations metrics",
        "Service desk performance",
        "Centralized services monitoring",
        "Professional services tracking",
        "TAM activity metrics",
        "vCIO performance reporting",
        "Quarterly goal tracking",
        "Year-over-year analytics"
      ]
    }
    </script>

    <link rel="stylesheet" href="css/styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <script src="https://alcdn.msauth.net/browser/2.30.0/js/msal-browser.min.js"></script>
    <style>
        .scorecard-container { background: white; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); margin: 20px; }
        .scorecard-header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 1.5rem 2rem; text-align: center; }
        .scorecard-header h1 { margin: 0 0 0.5rem 0; font-size: 2rem; font-weight: 700; }
        .scorecard-header p { margin: 0; font-size: 1rem; opacity: 0.95; }
        .table-wrapper { overflow-x: auto; overflow-y: visible; padding: 1.5rem; max-width: 100%; }
        table { width: max-content; min-width: 100%; border-collapse: collapse; font-size: 13px; table-layout: auto; }
        th, td { padding: 10px 14px; text-align: left; border: 1px solid #e1e8ed; white-space: nowrap; vertical-align: middle; }
        th { background: #34495e; color: white; font-weight: 600; position: sticky; top: 0; z-index: 10; line-height: 1.4; padding: 12px 14px; }
        th.metric-col { width: 280px; background: #2c3e50; }
        th.owner-col { width: 120px; }
        th.goal-col { width: 90px; }
        th.week-col { min-width: 80px; text-align: center; background: #667eea; }
        th.quarter-col { min-width: 100px; text-align: center; background: #5a67d8; cursor: pointer; user-select: none; }
        th.quarter-col:hover { background: #4c51bf; }
        th.quarter-col.expanded { background: #48bb78; }
        th.year-col { min-width: 100px; text-align: center; background: #2c3e50; }

        td.metric-name { font-weight: 600; background: #f8f9fa; padding: 10px 14px; }
        td.section-header { background: #e9ecef; font-weight: 700; font-size: 14px; color: #495057; padding: 12px 14px; }
        td.week-value { text-align: center; font-weight: 500; }
        td.quarter-summary { text-align: center; font-weight: 600; background: #edf2f7; }
        td.year-total { text-align: center; font-weight: 700; background: #e2e8f0; }

        .good { background: #d4edda !important; color: #155724; }
        .warning { background: #fff3cd !important; color: #856404; }
        .bad { background: #f8d7da !important; color: #721c24; }
        .empty { background: #fafafa; color: #999; }

        .quarter-toggle { font-size: 12px; margin-left: 5px; }
        .hidden-col { display: none; }
    </style>
</head>
<body class="dashboard-page">
    <div class="dashboard-container">
        <!-- Partner Portal Navigation (loaded from includes/partner-nav.html) -->
        <div id="partner-nav-placeholder"></div>
        <script src="js/load-nav.js"></script>
        <main class="dashboard-main">
            <div class="scorecard-container">
                <div class="scorecard-header">
                    <h1>ðŸŽ¯ TotalCareIT Scorecard 2025</h1>
                    <p>Full Year Performance Dashboard - Click quarters to expand/collapse</p>
                </div>
                <div class="table-wrapper">
                    <table id="scorecardTable">
                        <thead id="tableHeader"></thead>
                        <tbody id="tableBody"></tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>
    <script src="js/auth.js"></script>
    <script>
        let scorecardData = null;
        let expandedQuarters = { Q1: false, Q2: false, Q3: false, Q4: true }; // Q4 expanded by default

        async function loadScorecard() {
            try {
                const response = await fetch('data/scorecard-2025-full.json');
                scorecardData = await response.json();
                renderScorecard();
            } catch (error) {
                console.error('Error loading scorecard:', error);
            }
        }

        function toggleQuarter(quarter) {
            expandedQuarters[quarter] = !expandedQuarters[quarter];
            renderScorecard();
        }

        function renderScorecard() {
            if (!scorecardData) return;

            const thead = document.getElementById('tableHeader');
            const tbody = document.getElementById('tableBody');

            // Build header row
            let headerHTML = '<tr>';
            headerHTML += '<th class="metric-col">Metric / KPI</th>';
            headerHTML += '<th class="owner-col">Owner</th>';
            headerHTML += '<th class="goal-col">Goal</th>';

            // Add quarter headers
            ['Q1', 'Q2', 'Q3', 'Q4'].forEach(q => {
                const isExpanded = expandedQuarters[q];
                const qData = scorecardData.quarters[q];

                if (isExpanded) {
                    // Show all weeks for this quarter
                    qData.week_headers.forEach(week => {
                        headerHTML += `<th class="week-col quarter-${q}">${week}</th>`;
                    });
                }

                // Always show quarter summary column (clickable)
                const expandedClass = isExpanded ? 'expanded' : '';
                const arrow = isExpanded ? 'â–¼' : 'â–¶';
                headerHTML += `<th class="quarter-col ${expandedClass}" onclick="toggleQuarter('${q}')">${q} <span class="quarter-toggle">${arrow}</span></th>`;
            });

            headerHTML += '<th class="year-col">Year</th>';
            headerHTML += '</tr>';
            thead.innerHTML = headerHTML;

            // Build body rows
            let bodyHTML = '';
            scorecardData.metrics.forEach(metric => {
                bodyHTML += '<tr>';

                // KPI name, owner, goal
                if (metric.is_section) {
                    bodyHTML += `<td class="section-header">${metric.kpi}</td>`;
                    bodyHTML += `<td class="section-header">${metric.owner}</td>`;
                    bodyHTML += `<td class="section-header">${metric.goal}</td>`;
                } else {
                    bodyHTML += `<td class="metric-name">${metric.kpi}</td>`;
                    bodyHTML += `<td>${metric.owner}</td>`;
                    bodyHTML += `<td>${metric.goal}</td>`;
                }

                // Quarter data
                ['Q1', 'Q2', 'Q3', 'Q4'].forEach(q => {
                    const isExpanded = expandedQuarters[q];
                    const qData = metric.quarters[q];

                    if (isExpanded) {
                        // Show all week values with formatting
                        qData.values.forEach(val => {
                            const cssClass = metric.is_section ? 'section-header' : getValueClass(val);
                            const formattedVal = metric.is_section ? val : formatValue(val, metric.format);
                            bodyHTML += `<td class="${cssClass}">${formattedVal}</td>`;
                        });
                    }

                    // Quarter summary with formatting
                    const summaryClass = metric.is_section ? 'section-header' : 'quarter-summary';
                    const formattedSummary = metric.is_section ? qData.summary : formatValue(qData.summary, metric.format);
                    bodyHTML += `<td class="${summaryClass}">${formattedSummary}</td>`;
                });

                // Year total with formatting
                const yearClass = metric.is_section ? 'section-header' : 'year-total';
                const formattedYear = metric.is_section ? metric.year_total : formatValue(metric.year_total, metric.format);
                bodyHTML += `<td class="${yearClass}">${formattedYear}</td>`;
                bodyHTML += '</tr>';
            });

            tbody.innerHTML = bodyHTML;
        }

        function formatValue(value, format) {
            // Handle empty, null, undefined values
            if (value === '-' || value === 'nan' || value === null || value === undefined || value === '') {
                return '-';
            }

            // Handle string values that might be empty or whitespace
            if (typeof value === 'string') {
                const trimmed = value.trim();
                if (trimmed === '' || trimmed === 'nan' || trimmed === 'NaN') {
                    return '-';
                }
            }

            // Try to parse as number
            const num = parseFloat(value);
            if (isNaN(num)) {
                // Return trimmed string if not a number
                return typeof value === 'string' ? value.trim() : String(value);
            }

            // Apply formatting based on Excel number format
            if (format === '0') {
                // Whole number
                return Math.round(num).toString();
            } else if (format === '0.0%') {
                // Percentage with 1 decimal (value is already decimal, e.g., 0.697 = 69.7%)
                return (num * 100).toFixed(1) + '%';
            } else if (format === '0.00%' || format === '0%') {
                // Percentage with 2 decimals or whole percent
                const decimals = format === '0%' ? 0 : 2;
                return (num * 100).toFixed(decimals) + '%';
            } else if (format === '0.00') {
                // Decimal with 2 places
                return num.toFixed(2);
            } else if (format.includes('#,##0')) {
                // Comma-separated number
                return Math.round(num).toLocaleString();
            } else {
                // Default: try to detect if it's a whole number or decimal
                if (Number.isInteger(num)) {
                    return num.toString();
                } else {
                    return num.toFixed(2);
                }
            }
        }

        function getValueClass(value) {
            if (value === '-' || value === 'nan') return 'empty';
            return 'week-value';
        }

        // Load on page load
        document.addEventListener('DOMContentLoaded', loadScorecard);
    </script>
</body>
</html>
